from django.db import models
from accounts.models import UserAccount
from .validators import validate_file_extension
import datetime
from datetime import date, timedelta
from time import gmtime, strftime


# Create your models here.

import os
def content_file_name(instance, filename):
    showtime = strftime("%d-%m-%Y", gmtime())
    ext = filename.split('.')[-1]
    filename = "%s_%s.%s" % (instance.uploaded_by.id, showtime, ext)
    return os.path.join('uploaded_files', filename)

class FileUpload(models.Model):
    uploaded_by = models.ForeignKey(UserAccount, on_delete=models.CASCADE, default='1')
    docfile = models.FileField(blank=False, null=False, upload_to=content_file_name, validators=[validate_file_extension])
    remarque = models.CharField(max_length=20)
    timestamp = models.DateTimeField(auto_now_add=True)
    activated = models.BooleanField(default=True)

    def __str__(self):
        return "File id: {}".format(self.id)