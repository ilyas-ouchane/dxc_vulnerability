import React, { useState, useEffect } from 'react'
import { useHistory, useLocation } from 'react-router-dom'
import axios from 'axios'
import {
  CBadge,
  CCard,
  CCardBody,
  CCardHeader,
  CCol,
  CDataTable,
  CRow,
  CPagination
} from '@coreui/react'

// import usersData from './UsersData'


const getBadge = status => {
  switch (status) {
    default: return 'success'
  }
}

const StatutsNonFiltres = () => {
  const [files_data, setFilesData] = useState([])
  const history = useHistory()
  const queryPage = useLocation().search.match(/page=([0-9]+)/, '')
  const currentPage = Number(queryPage && queryPage[1] ? queryPage[1] : 1)
  const [page, setPage] = useState(currentPage)

  const pageChange = newPage => {
    currentPage !== newPage && history.push(`/users?page=${newPage}`)
  }

  useEffect(async () => {
    
  const config = {
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('token')}`,
      'Content-Type': 'multipart/form-data'
    }
  };

    const res = await axios('http://localhost:8000/api/files_upload/statuts_non_filtres/',config)
    res.data.lastItem = res.data.lastItem.map(v => v.toLowerCase())
    // console.log('res.data', res.data)
    setFilesData(res.data)
  }, [])
  
  useEffect(() => {
    currentPage !== page && setPage(currentPage)
  }, [currentPage, page])

  const fields = files_data.lastItem
  const filesData = []

  for (let i in files_data) {
    filesData[i] = { ...files_data[i] }
  }

  const changeKeyObjects = (arr, replaceKeys) => {
    return arr.map(item => {
      const newItem = {};
      Object.keys(item).forEach(key => {
        newItem[replaceKeys[key]] = item[[key]];
      });
      return newItem;
    });
  };

  const replaceKeys = filesData.lastItem
  var newArray = changeKeyObjects(filesData, replaceKeys);
  delete newArray[newArray.length-1]
  
  return (
    <CRow>
      <CCol>
          <CCard>
            <CCardHeader>
              <b>Statuts Non filtr√© Si Obsolette Inclus </b>
            </CCardHeader>
            <CCardBody>
            <CDataTable
              items={newArray}
              fields={fields}
              hover
              striped
              bordered
              size="sm"
              itemsPerPage={50}
              pagination
              scopedSlots = {{
                'total':
                  (item)=>(
                    <td>
                      <CBadge color={getBadge(item.total)}>
                        {item.total}
                      </CBadge>
                    </td>
                  )
              }}
            />
            </CCardBody>
          </CCard>
        </CCol>
    </CRow>
  )
}

export default StatutsNonFiltres