import React, { useState, useEffect } from 'react'
import { useHistory, useLocation } from 'react-router-dom'
import axios from 'axios'
import {
  CBadge,
  CCard,
  CCardBody,
  CCardHeader,
  CCol,
  CDataTable,
  CRow,
  CPagination
} from '@coreui/react'

// import usersData from './UsersData'


const getBadge = status => {
  switch (status) {
    case 'true': return 'success'
    case 'false': return 'warning'
    default: return 'primary'
  }
}

const FilesData = () => {
  const [files_data, setFilesData] = useState([])
  const history = useHistory()
  const queryPage = useLocation().search.match(/page=([0-9]+)/, '')
  const currentPage = Number(queryPage && queryPage[1] ? queryPage[1] : 1)
  const [page, setPage] = useState(currentPage)

  const pageChange = newPage => {
    currentPage !== newPage && history.push(`/users?page=${newPage}`)
  }

  useEffect(async () => {
    
  const config = {
    headers: {
      'Authorization': `Bearer ${localStorage.getItem('token')}`,
      'Content-Type': 'multipart/form-data'
    }
  };

    const res = await axios('http://localhost:8000/api/files_upload/selected_files_data/',config)
    res.data.lastItem = res.data.lastItem.map(v => v.toLowerCase())
    console.log('res.data', res.data)
    setFilesData(res.data)
  }, [])
  
  useEffect(() => {
    currentPage !== page && setPage(currentPage)
  }, [currentPage, page])

  const fields = files_data.lastItem;
  const filesData = []

  console.log('files_data', files_data)

  // for (let i in fields) {
  //   console.log(fields[i])
  // }

  files_data.map(file => (
    filesData.push({'scan': file.lastItem, 'total': file[3], 't4-20': file[2], "t2-20":file[1], "t1-21":file[0]  })
  ))


  console.log('filesData', filesData)
    
  return (
    <CRow>
      <CCol>
          <CCard>
            <CCardHeader>
              Combined All Table
            </CCardHeader>
            <div>
            {/* [files_data.lastIndex] */}
              {/* {files_data[files_data.lastIndex]} */}
            </div>
            <CCardBody>
            <CDataTable
              items={filesData}
              fields={fields}
              hover
              striped
              bordered
              size="sm"
              itemsPerPage={50}
              pagination
              scopedSlots = {{
                'status':
                  (item)=>(
                    <td>
                      <CBadge color={getBadge(item.status)}>
                        {item.status}
                      </CBadge>
                    </td>
                  )
              }}
            />
            </CCardBody>
          </CCard>
        </CCol>
    </CRow>
  )
}

export default FilesData
